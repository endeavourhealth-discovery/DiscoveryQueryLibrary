-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-- %% Step 2
-- %% Get all observations on the cohort
-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

use data_extracts;

drop procedure if exists BF2_Get_All_Observations;
DELIMITER //
create procedure BF2_Get_All_Observations()
BEGIN

	-- find the superset of (person, patient, org) for which we have IG clearance
	-- Barts A&E encounters and GP surgeries within the 4 Inner NEL CCGs
	drop table if exists cohort;
	create temporary table cohort as
		(
			select distinct person_id, patient_id, organization_id from F50_bartsfrailty_ae_encounters
		)
		union
		(
			select distinct gp.person_id, gp.patient_id, gp.organization_id
			from F50_bartsfrailty_GP_in_area as gp
			inner join F50_bartsfrailty_ae_encounters as ae
				on gp.person_id = ae.person_id
			where gp.age_in_years >= 65 		-- exclude anyone under 65
			and ae.person_id is not null 		-- exclude any gp data for anyone without AE encounter (belt and braces, inner join should suffice!)
		)
	;
	create index person_id on cohort(person_id);
	create index patient_id on cohort(patient_id);
	create index organization_id on cohort(organization_id);

	-- pull back all the observations from each person-patient-org combination
	call F50_get_all_obs_on_cohort(1500,'cohort','F50_bartsfrailty_all_obs');

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- Batch up and process by codesets
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	-- INPUT DATASET(S): Userdefinable within function

	-- F50_join_to_observation stored proc INPUTS:
	-- codeset (varcar) - Codes to search for within the f50_add_obs_column stored proc
	-- column_name (varcar) - Name of new column to add
	-- table_name (varcar) - Table to add all this information to
	-- input_cohort - Input cohort table
	-- input_observation - Input observation table
	-- OUTPUTS: New copy of table_name with columns added

	-- OUTPUT DATASET: F50_bartsfrailty_observations

	-- initialise cohort observations data (should be same as output dataset with _temp appended)
	drop table if exists F50_bartsfrailty_observations_temp;
	create table F50_bartsfrailty_observations_temp as select person_id, patient_id from cohort;
	alter table F50_bartsfrailty_observations_temp add index (person_id);
	alter table F50_bartsfrailty_observations_temp add index (patient_id);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- Frailty Flags
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Frailty (GP Record)
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'248279007,925791000000100,925861000000102,925831000000107,248279007,925791000000100,925861000000102,925831000000107',
			'frailty_gp',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Delirium (GP Record)
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'2776000,191461002,191507002,2776000,231440006,10349009,191452002,725898002,725898002,231440006,10349009,10349009,361151007,762324008,191464005,191461002,737339005,722961009,191452002,724746000,724746000,142011000119109,725898002,10349009,4817008,191464005,724746000,142011000119109,4817008,65096006',
			'delirium_gp',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- Comorbidities
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Falls
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'168198004,129839007,298344006,298344006,279992002,129839007,404912005,129839007,298343000,835591000000101,455201601000132100,298344006,249995008,279992002,332721351000132106,408561005,404912005,404911003,129839007,430576002,455201601000132100,835591000000101,249995008,404911003',
			'falls',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Cancer A (There are too many snomed codes for cancer!!)
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'105111000119109,105121000119102,10708511000119108,10745291000119103,10749871000119100,107581000119103,107591000119100,107601000119107,107691000119101,107751000119102,107771000119106,107781000119109,107791000119107,1078881000119102,1078901000119100,1078931000119107,1078961000119104,1080111000119108,1080151000119109,1080161000119106,1080191000119104,1080231000119108,1080241000119104,1080261000119100,1080341000119105,1080941000119109,1080981000119104,1081021000119109,1081551000119106,1081561000119108,1081711000119104,1081751000119103,1081781000119105,1081811000119107,1082071000119102,1082281000119105,1082291000119108,1082301000119109,1082311000119107,1090081000000106,1090091000000108,1090101000000100,1090121000000109,1090131000000106,1090141000000102,1090151000000104,1090161000000101,1090171000000108,1090181000000105,1090191000000107,1090201000000109,1090211000000106,1090221000000100,1090231000000103,1090241000000107,1090251000000105,1090261000000108,1090271000000101,1090281000000104,1090291000000102,1090821000000101,1090871000000102,1090881000000100,1090891000000103,1090901000000102,1090921000000106,1090931000000108,1090971000000105,1090981000000107,1091861000000100,1091891000000106,1091921000000103,109264009,109267002,1092831000000100,109347009,109348004,109349007,109356001,109357005,109358000,109359008,109366009,109367000,109368005,109369002,109370001,109371002,109374005,109378008,109383000,109384006,109385007,109386008,109388009,109389001,109390005,109391009,109392002,109821008,109822001,109823006,109824000,109828002,109830000,109831001,109832008,109833003,109834009,109835005,109836006,109837002,109838007,109839004,109840002,109841003,109842005,109843000,109844006,109847004,109848009,109851002,109853004,109854005,109855006,109856007,109858008,109870007,109874003,109875002,109876001,109878000,109879008,109880006,109882003,109885001,109886000,109887009,1098981000119101,109911004,109912006,109915008,109918005,109919002,109921007,109923005,109925003,109927006,109931000,109933002,109937001,109939003,109941002,109943004,109945006,109947003,109948008,109951001,109962001,109964000,109965004,109966003,109967007,109968002,109969005,109970006,109971005,109972003,109975001,109976000,109977009,109978004,109979007,109980005,109982002,109984001,109985000,109988003,109989006,109991003,109992005,109994006,109995007,109996008,109998009,110000005,110002002,110004001,110005000,110006004,110007008,110013004,11010461000119101,116381000119105,116811000119106,116821000119104,118599009,118600007,118601006,118602004,118605002,118606001,118607005,118608000,118609008,118610003,118611004,118612006,118613001,118614007,118615008,118617000,118618005,12240951000119107,12240991000119102,12246561000119101,12301000132103,12311000132101,123313007,123631000119103,123842006,123845008,126667002,126724001,126879004,126885006,126906006,126909004,127021009,127066000,127070008,127220001,127225006,128041000119107,128462008,128465005,128466006,128874001,128875000,129000002,13048006,13351431000119102,133531000119104,133751000119102,133871000119103,133881000119100,134312002,134421000,145831000119103,147101000119108,147131000119101,15635721000119108,15635801000119106,15956181000119102,15956341000119105,15956381000119100,16260631000119101,16341002,1651000119109,1661000119106,1671000119100,1681000119102,1691000119104,1701000119104,18121000119104,184741000119107,184781000119102,184871000119108,184881000119106,184891000119109,187601000,187604008,187606005,187608006,187613005,187614004,187622006,187624007,187631006,187633009,187634003,187635002,187637005,187640005,187641009,187644001,187652003,187653008,187658004,187659007,187660002,187661003,187662005,187666008,187675005,187681002,187682009,187683004,187685006,187688008,187692001,187693006,187694000,187697007,187698002,187700006,187701005,187702003,187708004,187709007,187716008,187722004,187723009,187724003,187725002,187726001,187727005,187732006,187733001,187734007,187736009,187738005,187740000,187741001,187742008,187752007,187757001,187760008,187767006,187769009,187773007,187776004,187777008,187784000,187786003,187791002,187792009,187793004,187794005,187798008,187801002,187803004,187804005,187807003,187808008,187809000,187810005,187811009,187814001,187821001,187822008,187824009,187828007,187829004,187830009,187831008,187833006,187834000,187835004,187836003,187838002,187841006,187842004,187843009,187844003,187845002,187846001,187853005,187854004,187857006,187861000,187862007,187864008,187865009,187866005,187868006,187869003,187870002,187881004,187900002,187903000,187906008,187916000,187917009,187918004,187920001,187925006,187926007,187927003,187929000,187932002,187937008,187938003,187939006,187940008,187941007,187942000,187943005,187944004,187945003,187946002,187947006,187948001,187949009,187950009,187952001,187956003,187957007,187967002,187968007,187969004,187970003,187972006,187973001,187974007,187975008,187976009,187977000,187978005,187987001,187988006,187989003,187991006,187992004,187993009,187994003,187995002,187996001,187997005,187999008,188000002,188001003,188002005,188003000,188004006,188005007,188006008,188009001,188010006,188013008,188015001,188016000,188017009,188019007,188020001,188021002,188022009,188023004,188029000,188030005,188032002,188033007,188034001,188038003,188040008,188042000,188044004,188045003,188046002,188049009,188050009,188051008,188052001,188054000,188055004,188060000,188061001,188062008,188063003,188064009,188065005,188067002,188068007,188069004,188070003,188071004,188072006,188073001,188074007,188075008,188076009,188077000,188102008,188147009,188151006,188152004,188153009,188154003,188155002,188156001,188157005,188159008,188163001,188168005,188176007,188177003,188180002,188183000,188184006,188188009,188189001,188190005,188191009,188192002,188193007,188195000,188198003,188204000,188208002,188209005,188211001,188219004,188220005,188230001,188234005,188235006,188239000,188240003,188241004,188242006,188243001,188244007,188245008,188247000,188250002,188251003,188252005,188253000,188256008,188261005,188263008,188264002,188265001,188266000,188268004,188269007,188272000,188273005,188274004,188280007,188281006,188282004,188283009,188285002,188286001,188287005,188289008,188290004,188292007,188293002,188295009,188296005,188297001,188298006,188301005,188302003,188307009,188308004,188312005,188313000,188315007,188317004,188318009,188319001,188321006,188322004,188323009,188324003,188325002,188326001,188327005,188339002,188340000,188353002,188361007,188366002,188445006,188454009,188458007,188459004,188462001,188469005,188471005,188478004,188487008,188489006,188492005,188493000,188498009,188500005,188501009,188502002,188503007,188504001,188505000,188506004,188507008,188510001,188511002,188512009,188513004,188514005,188515006,188516007,188517003,188524002,188526000,188529007,188531003,188534006,188536008,188537004,188538009,188541000,188544008,188547001,188548006,188551004,188554007,188558005,188559002,188562004,188565002,188566001,188567005,188568000,188569008,188570009,188572001,188575004,188576003,188577007,188578002,188579005,188580008,188582000,188585003,188586002,188587006,188589009,188590000,188591001,188592008,188593003,188609000,188612002,188613007,188627002,188630009,188631008,188632001,188633006,188634000,188635004,188637007,188640007,188641006,188642004,188645002,188648000,188649008,188660004,188662007,188663002,188664008,188665009,188666005,188667001,188668006,188669003,188672005,188674006,188675007,188676008,188679001,188691005,188718006,188725004,188726003,188728002,188729005,188732008,188733003,188734009,188736006,188737002,188738007,188741003,188744006,188745007,188746008,188748009,188754005,188768003,188770007,189509003,189815007,190030009,190818004,20224008,208041000119100,21851000119103,230156002,231829006,231831002,231833004,231834005,231835006,232075002,233940007,234941000119100,235965006,235966007,236005001,236512004,236513009,236811000119101,237252008,237833006,238636003,239297008,240163000,240531002,24111000119105,241861008,242862004,242951000119108,25050002,253000007,253001006,253003009,253006001,253017000,253018005,253042009,253096008,254389005,254390001,254393004,254398008,254402004,254404003,254408000,254412006,254417000,254423005,254424004,254425003,254427006,254431000,254434008,254435009,254436005,254437001,254441002,254445006,254450000,254454009,254457002,254459004,254462001,254465004,254466003,254474002,254478004,254481009,254484001,254503007,254509006,254513004,254517003,254520006,254526000,254530002,254535007,254539001,254543002,254547001,254549003,254551004,254553001,254555008,254557000,254559002,254561006,254563009,254567005,254570009,254582000,254586002,254601002,254609000,254611009,254612002,254619006,254620000,254622008,254625005,254626006,254627002,254628007,254629004,254631008,254632001,254633006,254634000,254635004,254637007,254638002,254645002,254653005,254707006,254708001,254709009,254711000,254712007,254713002,254714008,254726003,254730000,254731001,254732008,254733003,254734009,254748009,254764001,254771006,254792006,254794007,254797000,254800003,254824006,254828009,254829001,254837009,254838004,254839007,254840009,254841008,254843006,254844000,254849005,254850005,254851009,254852002,254855000,254856004,254860001,254861002,254863004,254869000,254870004,254871000,254872007,254874008,254876005,254877001,254878006,254886006,254887002,254888007,254889004,254893005,254895003,254896002,254897006,254900004,254904008,254912000,254915003,254916002,254917006,254918001,254934003,254938000,254940005,254948003,254950006,254955001,254969001,254972008,254973003,254974009,254975005,254980001,254983004,254986007,254987003,254988008,254989000,254990009,254993006,254994000,254995004,254996003,255003007,255004001,255008003,255012009,255015006,255016007,255017003,255021005,255028004,255029007,255030002,255031003,255032005,255035007,255037004,255044008,255052006,255056009,255066001,255067005,255069008,255071008,255072001,255073006,255074000,255075004
			,255077007,255078002,255081007,255083005,255084004,255086002,255087006,255088001,255090000,255091001,255093003,255101006,255102004,255107005,255108000,255109008,255110003,255111004,255112006,255114007,255115008,255118005,255119002,255121007,255123005,255124004,255127006,255128001,255129009,255191003,269459004,269460009,269463006,269464000,269467007,269469005,269473008,269475001,269476000,269515006,269516007,269533000,269544008,269578002,269579005,269580008,269581007,269616004,269617008,271323007,271468000,271568003,271943005,274084007,274085008,274087000,274088005,274902006,274905008,275266006,275394001,275395000,275396004,275397008,275399006,275419009,275490009,275524009,276419004,276420005,276751004,276797002,276799004,276803003,276804009,276809004,276810009,276811008,276815004,276821000,276822007,276826005,276827001,276828006,276829003,276836002,276870001,276876007,276952000,276953005,276954004,276962007,276975007,277156006,277461004,277466009,277473004,277474005,277505007,277530005,277543005,277545003,277549009,277550009,277551008,277567002,277568007,277569004,277570003,277571004,277572006,277573001,277574007,277575008,277579002,277580004,277587001,277589003,277597005,277601005,277602003,277604002,277605001,277609007,277610002,277611003,277612005,277613000,277614006,277615007,277616008,277617004,277618009,277619001,277622004,277623009,277624003,277625002,277626001,277627005,277628000,277629008,277632006,277637000,277641001,277642008,277643003,277651000,277653002,277654008,277664004,277782009,278024000,278042005,278043000,278044006,278046008,278050001,278051002,278052009,278053004,278054005,278055006,278057003,278060005,278065000,278189009,278433008,278453007,278491007,280959007,281560004,281562007,281563002,281564008,281565009,281566005,281702006,285310000,285312008,285420006,285421005,285422003,285432005,285598005,285603002,285604008,285605009,285606005,285607001,285608006,285609003,285610008,285611007,285612000,285613005,285614004,285615003,285616002,285617006,285618001,285619009,285631006,285633009,285634003,285635002,285637005,285638000,285639008,285640005,285641009,285642002,285643007,285644001,285645000,285769009,285776004,285839005,286889008,286890004,286893002,286894008,286895009,286896005,286897001,286899003,286900008,286902000,29421000119105,294301000000103,300988009,301756000,302815008,302816009,302817000,302835009,302837001,302841002,302842009,302845006,302847003,302848008,302849000,302851001,302855005,302856006,303012000,303017006,303055001,303056000,303057009,303194003,303201005,304545002,30664006,307216009,307219002,307226002,307341004,307502000,307576001,307592006,307593001,307599002,307601000,307603002,307608006,307609003,307610008,307617006,307622006,307623001,307624007,307625008,307633009,307634003,307635002,307636001,307637005,307646004,307647008,307649006,307650006,307651005,308121000,309245001,31047003,310498001,310504009,310526005,310599006,312104005,312111009,312112002,312113007,312114001,312115000,312949007,313248004,313249007,313250007,313353007,313354001,313355000,313356004,313357008,313427003,313428008,313429000,314191009,314408000,314418005,314951005,314952003,314953008,314954002,314955001,314960002,314961003,314962005,314963000,314964006,314965007,314966008,314967004,314968009,314969001,314970000,314973003,314974009,314976006,314987003,314988008,314989000,314990009,314991008,314992001,314993006,314994000,314995004,314996003,314997007,314998002,314999005,315000005,315001009,315002002,315003007,315004001,315005000,315006004,315007008,315008003,315009006,315058005,326072005,342511000000104,342561000000102,342571000000109,351461000119100,352001000119100,352071000119105,352201000119105,352231000119103,352301000119103,352311000119100,352321000119107,353561000119103,353661000119102,353671000119108,353741000119106,354351000119105,354361000119107,354621000119105,354641000119104,354651000119102,354671000119106,354681000119109,35868009,359631009,359640008,359648001,359780007,359782004,359785002,359987004,363346000,363348004,363349007,363350007,363351006,363352004,363353009,363354003,363355002,363357005,363358000,363359008,363360003,363363001,363364007,363365008,363366009,363367000,363368005,363369002,363370001,363372009,363373004,363374005,363375006,363376007,363377003,363378008,363379000,363380002,363381003,363382005,363383000,363384006,363385007,363386008,363387004,363388009,363389001,363390005,363391009,363392002,363393007,363394001,363395000,363396004,363397008,363398003,363399006,363400004,363401000,363402007,363403002,363404008,363405009,363406005,363407001,363408006,363409003,363410008,363411007,363412000,363413005,363414004,363415003,363416002,363417006,363418001,363419009,363420003,363421004,363422006,363423001,363424007,363425008,363426009,363427000,363428005,363429002,363430007,363431006,363432004,363433009,363434003,363435002,363436001,363437005,363438000,363439008,363440005,363441009,363443007,363444001,363445000,363446004,363447008,363449006,363451005,363452003,363453008,363454002,363456000,363457009,363458004,363459007,363460002,363461003,363462005,363463000,363464006,363465007,363466008,363467004,363468009,363469001,363470000,363471001,363473003,363474009,363475005,363476006,363477002,363478007,363481002,363482009,363483004,363484005,363485006,363486007,363487003,363488008,363489000,363490009,363491008,363492001,363493006,363494000,363495004,363496003,363497007,363498002,363499005,363500001,363501002,363502009,363503004,363504005,363505006,363506007,363507003,363508008,363509000,363510005,363514001,363515000,363516004,363517008,363518003,363745004,369448007,369449004,369450004,369451000,369452007,369453002,369454008,369455009,369456005,369457001,369458006,369459003,369460008,369461007,369463005,369464004,369465003,369466002,369467006,369468001,369469009,369470005,369471009,369472002,369473007,369474001,369475000,369476004,369477008,369478003,369479006,369480009,369481008,369482001,369483006,369484000,369485004,369486003,369487007,369488002,369489005,369490001,369491002,369492009,369493004,369494005,369495006,369496007,369497003,369498008,369499000,369500009,369501008,369502001,369503006,369504000,369505004,369506003,369507007,369508002,369509005,369510000,369511001,369512008,369513003,369514009,369515005,369516006,369517002,369518007,369519004,369520005,369521009,369522002,369523007,369524001,369525000,369526004,369527008,369528003,369529006,369530001,369531002,369532009,369533004,369534005,369535006,369536007,369538008,369540003,369541004,369542006,369543001,369544007,369545008,369546009,369547000,369548005,369549002,369550002,369551003,369552005,369553000,369554006,369555007,369556008,369557004,369558009,369559001,369560006,369561005,369562003,369563008,369564002,369565001,369566000,369567009,369568004,369569007,369570008,369571007,369572000,369573005,369574004,369575003,369576002,369577006,369578001,369579009,369580007,369581006,369582004,369583009,369584003,369585002,369586001,369587005,369588000,369589008,369590004,369591000,369592007,369593002,369594008,369595009,369596005,369597001,369598006,369599003,369600000,369601001,369602008,369603003,369604009,369605005,369606006,369607002,369608007,369609004,369610009,370511006,370967009,370987005,371012000,371134001,371962007,371963002,371964008,371965009,371966005,371967001,371968006,371969003,371970002,371971003,371972005,371973000,371974006,371975007,371976008,371977004,371978009,371979001,371980003,371981004,371982006,371983001,371984007,371986009,371987000,371988005,371989002,371990006,371991005,371992003,371993008,371994002,371995001,371996000,371997009,371998004,371999007,372000001,372001002,372002009,372003004,372004005,372005006,372006007,372007003,372008008,372009000,372010005,372011009,372012002,372013007,372014001,372015000,372016004,372017008,372018003,372019006,372020000,372021001,372022008,372023003,372024009,372025005,372026006,372027002,372028007,372030009,372062007,372063002,372064008,372065009,372087000,372092003,372093008,372094002,372095001,372096000,372097009,372098004,372099007,372100004,372101000,372103002,372104008,372105009,372106005,372107001,372108006,372110008,372111007,372112000,372113005,372115003,372116002,372119009,372120003,372121004,372131006,372133009,372135002,372136001,372137005,372138000,372139008,372140005,372141009,372142002,372143007,372244006,373080008,373081007,373082000,373083005,373088001,373089009,373090000,373091001,373168002,373627005,373888000,385478001,387922007,387927001,389216001,393563007,396181000000106,396198006,397008008,397009000,397011009,397015000,397141000000100,397641000000107,398623004,398670003,398903003,399068003,399326009,399490008,399590005,399660006,399884001,399969009,400001003,400058002,400074007,400122007,400173004,400175006,402558004,402559007,402560002,402561003,402562005,402563000,402564006,402636006,402815007,402816008,402871009,402873007,402876004,402879006,402880009,402881008,402882001,402910001,402912009,40312006,403458008,403711001,403713003,403714009,403889000,403890009,403900000,403901001,403902008,403903003,403904009,403906006,403920004,403921000,403922007,403923002,403924008,403925009,403926005,403927001,403929003,403939009,403940006,403941005,403942003,403943008,403944002,403947009,403949007,403950007,403951006,403954003,403955002,403977003,403978008,403979000,403986008,403996004,404008001,404009009,404010004,404014008,404015009,404016005,404017001,404037002,404038007,404039004,404040002,404041003,404045007,404046008,404047004,404051002,404052009,404053004,404054005,404055006,404056007,404067008,404068003,404069006,404070007,404071006,404072004,404073009,404077005,404079008,404080006,404081005,404087009,404088004,404089007,404090003,404091004,404092006,404093001,404094007,404103007,404104001,404105000,404106004,404107008,404108003,404109006,404110001,404111002,404112009,404113004,404114005,404115006,404116007,404117003,404118008,404119000,404120006,404121005,404122003,404123008,404124002,404125001,404126000,404127009,404128004,
			404129007,404130002,404131003,404132005,404133000,404134006,404135007,404136008,404137004,404138009,404139001,404140004,404141000,404142007,404143002,404144008,404145009,404146005,404147001,404148006,404149003,404150003,404151004,404152006,404153001,404154007,404155008,404156009,404157000,404169008,404172001,404664002,405546008,405822008,405843009,405945003,408642003,408643008,408644002,408645001,408646000,408647009,408648004,408649007,408911000000106,409171000000109,409231000000104,413389003,413441006,413442004,413445002,413446001,413537009,413587002,413656006,413842007,413843002,413847001,414166008,414553000,414676007,414780005,414785000,414791003,415110002,415112005,415177008,415283002,415284008,415285009,415286005,415287001,416274001,416402001,416669000,416712009,416769008,416842003,416901002,417181009,417417007,417554000,417570003,418372008,418529003,419052002,419240004,419842002,420302007,420519005,420524008,420788006,420890002,421246008,421249001,421283008,422282000,422541001,422599000,422691006,422736007,422758009,422782004,422833009,422853008,422886007,422968005,423005002,423032007,423038006,423050000,423106003,423121009,423158009,423189008,423195009,423280002,423294001,423295000,423318000,423384009,423424005,423447006,423464009,423468007,423494003,423506005,423595004,423600008,423607006,423610004,423615009,423627007,423673009,423691004,423700001,423708008,423746001,423793008,423807009,423812005,423829008,423973006,423987006,424052001,424132000,424151006,424190005,424276002,424302003,424334007,424413001,424440001,424487008,424549003,424779008,424849005,424887002,424938000,424952003,424954002,424970000,425048006,425066001,425111000000106,425127006,425178004,425225007,425230006,425231005,425303004,425333006,425376008,425657001,425688002,425749006,425869007,425941003,426071002,426124006,426217000,426248008,426336007,426370008,426642002,426885008,426964009,427038005,427056005,427141003,427374007,427492003,427642009,427658007,427685000,428061005,428100006,428281000,428322007,428905002,429033009,430338009,430556008,430621000,431396003,432328008,433067002,438946002,439478008,440173001,440397000,440422002,440501006,440525003,440527006,441313008,441535001,441559006,441962003,442537007,443144000,443250000,443261008,443333004,443439001,443487006,443488001,443493003,443520009,443648003,443675005,443679004,443719001,443936004,443937008,443961001,444596001,444597005,444604002,444712000,444910004,444911000,445105005,445227008,445238008,445269007,445406001,445448008,446022000,446189008,446643000,446807009,446939001,447100004,447109003,447266004,447389009,447390000,447416008,447656001,447658000,447705002,447706001,447707005,447708000,447710003,447712006,447730004,447757002,447766003,447781009,447782002,447783007,447784001,447785000,447792005,447800002,447804006,447805007,447806008,447882007,447883002,447885009,447886005,447949005,447951009,447989004,448139005,448165009,448212009,448213004,448214005,448215006,448216007,448217003,448218008,448220006,448221005,448229007,448231003,448233000,448248006,448250003,448254007,448257000,448258005,448259002,448269008,448273006,448274000,448296006,448298007,448299004,448300007,448314007,448317000,448319002,448354009,448371005,448372003,448376000,448377009,448378004,448384001,448386004,448387008,448388003,448401007,448408001,448435005,448436006,448447004,448449001,448450001,448451002,448465000,448468003,448509007,448553002,448554008,448555009,448558006,448559003,448560008,448561007,448607004,448609001,448663003,448664009,448665005,448666006,448668007,448669004,448670003,448672006,448674007,448675008,448709005,448710000,448711001,448712008,448738008,448774004,448775003,448776002,448863000,448864006,448865007,448867004,448868009,448882009,448922007,448930008,448931007,448952004,448954003,448988009,448989001,448990005,448992002,448993007,448994001,448995000,449034009,449053004,449054005,449055006,449058008,449059000,449063007,449065000,449066004,449067008,449072004,449073009,449074003,449075002,449077005,449096009,449100005,449101009,449108003,449153001,449156009,449173006,449176003,449177007,449206007,449207003,449208008,449216004,449217008,449218003,449219006,449220000,449221001,449222008,449223003,449224009,449248000,449253005,449254004,449259009,449260004,449267001,449268006,449269003,449292003,449293008,449294002,449295001,449307001,449308006,449318001,449377002,449386007,449417005,449418000,449419008,449420002,449472007,449487002,449497006,449578008,449627008,449628003,449630001,449631002,449632009,449633004,449635006,449636007,449637003,449803009,45221000119105,462401000000104,462461000000100,473419009,58961005,60620005,609515005,61291000119103,61301000119102,61493004,62497000,65399007,67811000119102,67821000119109,67831000119107,67841000119103,681601000119101,681621000119105,681631000119108,681721000119103,683991000119103,684911000119105,68979007,69408002,697993003,698011002,698040004,698041000,698042007,698043002,698044008,698045009,698048006,698200003,698285005,698286006,698287002,698288007,698646006,699028006,699317002,699318007,699354006,699355007,699356008,699357004,699358009,699657009,699659007,699704002,699818003,700423003,700488005,702368000,702369008,702391001,702392008,702405001,702446006,702467006,702476004,702785000,702786004,702977001,703228009,703230006,703387000,703429003,703625002,703626001,704152002,705061009,705176003,706970001,707337006,707339009,707342003,707343008,707344002,707345001,707346000,707347009,707348004,707349007,707350007,707353009,707354003,707355002,707356001,707357005,707358000,707359008,707360003,707361004,707362006,707377003,707378008,707379000,707380002,707383000,707384006,707385007,707386008,707388009,707389001,707390005,707391009,707392002,707393007,707394001,707395000,707396004,707398003,707399006,707400004,707401000,707402007,707403002,707404008,707405009,707406005,707407001,707408006,707409003,707410008,707411007,707421004,707422006,707423001,707424007,707425008,707426009,707427000,707429002,707430007,707451005,707452003,707453008,707454002,707455001,707456000,707457009,707458004,707460002,707464006,707465007,707466008,707467004,707468009,707469001,707470000,707471001,707472008,707473003,707475005,707479004,707481002,707482009,707483004,707484005,707485006,707486007,707487003,707489000,707490009,707491008,707492001,707493006,707494000,707495004,707528007,707529004,707531008,707532001,707535004,707537007,707538002,707539005,707575007,707576008,707579001,707580003,707581004,707582006,707583001,707584007,707585008,707586009,707587000,707588005,707589002,707590006,707591005,707592003,707593008,707595001,707596000,707627009,707628004,707660007,707662004,707664003,707670009,707671008,707672001,707673006,707674000,707686002,707697002,707703001,707704007,707705008,708054009,708504008,708921005,708971008,709031009,70910003,709285002,709471005,709517003,709830006,710195004,710196003,71111000119109,711414003,712525007,712750007,712849003,713038003,713189001,713290004,713293002,713325002,713327005,713483007,713516007,713572001,713573006,713574000,713609000,713646001,713718006,713897006,714251006,714463003,715412008,715414009,715664005,715901002,715903004,715950008,716586009,716588005,716593008,716647001,716648006,716649003,716651004,716652006,716653001,716654007,716657000,716659002,716788007,716855006,716859000,717734005,717735006,717736007,717916003,717921000,717922007,717968005,718195003,718200007,718220008,718604008,719052006,720587009,721302006,721303001,721304007,721305008,721306009,721308005,721310007,721311006,721313009,721314003,721540005,721541009,721546004,721547008,721548003,721549006,721555001,721556000,721557009,721558004,721559007,721560002,721561003,721562005,721563000,721567004,721568009,721569001,721574009,721575005,721576006,721577002,721578007,721579004,721580001,721602000,721603005,721604004,721605003,721606002,721607006,721617001,721618006,721619003,721620009,721621008,721622001,721623006,721624000,721625004,721626003,721627007,721628002,721629005,721630000,721632008,721633003,721634009,721635005,721636006,721637002,721638007,721639004,721640002,721641003,721642005,721643000,721644006,721645007,721669006,721670007,721671006,721672004,721673009,721695008,721696009,721697000,721698005,721699002,721700001,721701002,721709000,721716004,721718003,721725005,721762007,722103009,722112006,722229001,722425009,722444002,722445001,722509001,722510006,722511005,722512003,722513008,722514002,722515001,722516000,722517009,722518004,722519007,722524005,722527003,722528008,722529000,722530005,722533007,722542000,722543005,722665003,722666002,722670005,722671009,722672002,722673007,722674001,722676004,722677008,722678003,722679006,722680009,722681008,722682001,722683006,722684000,722685004,722686003,722687007,722707001,722714004,722718001,722795004,722827008,722828003,722832009,722953004,722954005,723076008,723077004,723173003,723182009,723265000,723281005,723301009,723843005,723844004,723845003,723846002,723847006,723848001,723849009,723850009,723851008,723852001,723853006,723854000,723855004,723856003,723879002,723887001,723889003,724056005,724058006,724059003,724060008,724467001,724468006,724536000,724537009,724552002,724553007,724554001,724644005,724645006,724647003,724648008,724649000,724650000,724805000,724806004,725390002,725437002,726019003,726652005,726653000,726654006,726721002,72891000119103,732201008,733064004,733134009,733135005,733136006,733144006,733162002,733163007,733343005,733344004,733345003,733346002,733347006,733348001,733349009,733350009,733351008,733352001,733353006,733354000,733355004,733356003,733357007,733358002,733359005,733360000,733361001,733362008,733470002,733471003,733598001,733603009,733608000,733627006,733834006,733926004,734015000,734066005,734099007,734522002,735332000,735385007,735450006,735678002,735679005,735680008,735735001,735757008,735916009,735918005,735919002,735920008,735921007,736322001,737058005,737308008,737309000,737310005,737311009,737312002,737313007,738527001,738770003,
			7391000119103,739301006,761958009,762315004,762316003,762457009,762458004,762665002,762690000,763063001,763064007,763131005,763309005,763408003,763409006,763477007,763479005,763666008,763719001,763771009,763796007,763884007,764694005,764735002,764737005,764845008,764846009,764847000,764855007,764856008,764938007,764940002,764951002,764952009,764961009,764990003,765095002,765136002,765328000,765740002,765741003,766045006,766046007,766048008,766247009,766248004,766752000,766757006,766758001,766759009,766930002,766935007,766978002,766979005,766980008,766981007,767444009,767448007,767544007,767812003,767813008,767814002,767817009,767818004,78411000119107,79281000119106,80914001,813671000000107,815011000000107,815361000000107,820601000000103,82501000119102,82546001,847481000000109,847631000000107,847651000000100,847691000000108,847701000000108,847741000000106,863741000000108,863761000000109,863781000000100,87091000119101,87111000119109,87121000119102,87151000119105,882791000000109,884601000000103,91031000119108,91041000119104,91061000119100,91081000119109,91131000119109,91151000119103,91161000119101,91171000119107,91281000119103,91854005,91855006,91856007,91857003,91858008,91860005,91861009,92508006,92509003,92510008,92511007,92512000,92513005,92514004,92515003,92516002,92767001,92811003,92812005,92813000,92814006,92817004,92818009,93133006,93134000,93135004,93136003,93137007,93138002,93139005,93140007,93141006,93142004,93143009,93144003,93145002,93146001,93147005,93148000,93149008,93150008,93151007,93152000,93169003,93182006,93183001,93184007,93185008,93186009,93187000,93188005,93189002,93190006,93191005,93192003,93193008,93194002,93195001,93196000,93197009,93198004,93199007,93200005,93201009,93202002,93203007,93204001,93205000,93206004,93207008,93208003,93209006,93210001,93211002,93213004,93214005,93215006,93216007,93217003,93218008,93219000,93220006,93221005,93222003,93223008,93224002,93225001,93226000,93227009,93228004,93229007,93230002,93450001,93451002,93487009,93488004,93489007,93492006,93493001,93494007,93495008,93496009,93497000,93498005,93500006,93501005,93505001,93506000,93507009,93509007,93510002,93514006,93515007,93516008,93518009,93519001,93520007,93521006,93522004,93523009,93524003,93525002,93526001,93527005,93528000,93530003,93531004,93532006,93533001,93534007,93536009,93537000,93541001,93542008,93543003,93545005,93546006,93547002,93548007,93549004,93550004,93551000,93552007,93554008,93555009,93636004,93637008,93638003,93640008,93641007,93642000,93643005,93644004,93645003,93646002,93647006,93648001,93649009,93650009,93651008,93652001,93653006,93654000,93655004,93657007,93658002,93659005,93660000,93661001,93662008,93665005,93667002,93669004,93670003,93671004,93672006,93674007,93676009,93677000,93679002,93680004,93681000,93682007,93683002,93684008,93686005',
			'cancer_a',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Cancer B (There are too many snomed codes for cancer!!)
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'93689003,93690007,93692004,93693009,93694003,93695002,93696001,93697005,93698000,93699008,93700009,93701008,93703006,93704000,93705004,93706003,93707007,93708002,93709005,93710000,93711001,93712008,93713003,93714009,93715005,93716006,93717002,93720005,93721009,93722002,93723007,93724001,93725000,93726004,93727008,93728003,93729006,93730001,93731002,93732009,93733004,93734005,93737003,93738008,93739000,93740003,93741004,93742006,93743001,93744007,93745008,93746009,93747000,93748005,93749002,93751003,93753000,93754006,93755007,93756008,93757004,93759001,93760006,93761005,93763008,93764002,93766000,93767009,93768004,93769007,93770008,93771007,93772000,93773005,93775003,93776002,93777006,93778001,93779009,93781006,93782004,93783009,93784003,93786001,93787005,93788000,93789008,93792007,93793002,93796005,93797001,93798006,93799003,93800004,93801000,93802007,93803002,93804008,93806005,93807001,93808006,93809003,93812000,93814004,93815003,93816002,93817006,93818001,93820003,93821004,93824007,93825008,93826009,93827000,93828005,93829002,93830007,93831006,93832004,93833009,93834003,93835002,93836001,93837005,93839008,93841009,93842002,93843007,93844001,93845000,93846004,93848003,93849006,93850006,93851005,93854002,93857009,93858004,93860002,93861003,93862005,93864006,93865007,93867004,93868009,93870000,93871001,93872008,93874009,93875005,93876006,93878007,93879004,93880001,93882009,93883004,93884005,93885006,93886007,93887003,93888008,93889000,93890009,93891008,93892001,93893006,93894000,93898002,93899005,93900000,93901001,93902008,93903003,93904009,93905005,93906006,93907002,93908007,93909004,93910009,93911008,93912001,93913006,93914000,93915004,93916003,93917007,93918002,93920004,93922007,93923002,93924008,93925009,93926005,93927001,93928006,93929003,93930008,93931007,93932000,93933005,93934004,93936002,93939009,93940006,93941005,93942003,93943008,93944002,93945001,93946000,93947009,93948004,93950007,93951006,93952004,93953009,93955002,93957005,93958000,93959008,93960003,93961004,93962006,93963001,93964007,93966009,93967000,93968005,93969002,93970001,93971002,93973004,93974005,93975006,93976007,93977003,93978008,93979000,93980002,93981003,93982005,93983000,93984006,93985007,93986008,93987004,93989001,93990005,93991009,93992002,93993007,93994001,93995000,93996004,93997008,93998003,94000008,94001007,94002000,94003005,94004004,94005003,94006002,94048009,94049001,94050001,94051002,94052009,94053004,94054005,94055006,94056007,94057003,94058008,94059000,94060005,94061009,94062002,94063007,94066004,94067008,94068003,94069006,94071006,94072004,94073009,94075002,94076001,94077005,94078000,94079008,94080006,94081005,94082003,94083008,94084002,94085001,94086000,94087009,94089007,94090003,94092006,94093001,94094007,94096009,94097000,94098005,94099002,94101009,94102002,94103007,94104001,94105000,94107008,94108003,94109006,94110001,94111002,94112009,94113004,94115006,94116007,94117003,94118008,94120006,94121005,94122003,94123008,94124002,94125001,94126000,94128004,94129007,94131003,94132005,94133000,94134006,94135007,94138009,94139001,94140004,94142007,94143002,94144008,94145009,94148006,94152006,94153001,94154007,94155008,94156009,94157000,94158005,94159002,94160007,94161006,94162004,94163009,94164003,94165002,94166001,94167005,94168000,94169008,94170009,94171008,94172001,94173006,94175004,94176003,94177007,94179005,94180008,94181007,94182000,94183005,94184004,94185003,94186002,94187006,94189009,94190000,94191001,94192008,94193003,94194009,94195005,94196006,94197002,94198007,94200001,94201002,94202009,94203004,94204005,94205006,94206007,94207003,94208008,94209000,94210005,94211009,94212002,94213007,94214001,94215000,94217008,94218003,94219006,94220000,94221001,94222008,94224009,94225005,94226006,94227002,94228007,94229004,94230009,94231008,94232001,94233006,94234000,94235004,94236003,94237007,94238002,94239005,94240007,94241006,94242004,94243009,94244003,94245002,94246001,94247005,94248000,94249008,94250008,94252000,94253005,94254004,94255003,94256002,94257006,94258001,94259009,94260004,94261000,94262007,94263002,94264008,94265009,94266005,94267001,94268006,94269003,94270002,94271003,94272005,94273000,94274006,94275007,94276008,94277004,94278009,94279001,94280003,94281004,94282006,94283001,94284007,94285008,94286009,94287000,94288005,94289002,94290006,94291000119103,94291005,94292003,94293008,94294002,94295001,94296000,94297009,94298004,94299007,94300004,94301000,94302007,94303002,94304008,94305009,94306005,94307001,94308006,94309003,94310008,94311007,94312000,94313005,94314004,94315003,94316002,94317006,94318001,94319009,94320003,94321004,94322006,94323001,94324007,94325008,94326009,94327000,94328005,94329002,94330007,94331006,94332004,94333009,94334003,94335002,94336001,94337005,94338000,94339008,94340005,94341009,94342002,94343007,94344001,94345000,94346004,94347008,94348003,94349006,94350006,94351005,94352003,94353008,94354002,94355001,94356000,94357009,94358004,94359007,94360002,94361000000105,94361003,94362005,94364006,94365007,94366008,94367004,94368009,94369001,94370000,94371001,94372008,94373003,94374009,94375005,94376006,94378007,94379004,94380001,94381002,94382009,94383004,94384005,94385006,94386007,94387003,94388008,94389000,94390009,94391008,94392001,94393006,94394000,94395004,94396003,94397007,94398002,94399005,94400003,94401004,94402006,94403001,94404007,94405008,94406009,94407000,94408005,94409002,94410007,94411006,94412004,94413009,94414003,94415002,94416001,94417005,94418000,94419008,94420002,94421003,94422005,94423000,94424006,94425007,94426008,94427004,94428009,94429001,94430006,94431005,94432003,94433008,94434002,94435001,94436000,94437009,94439007,94440009,94441008,94442001,94443006,94444000,94445004,94446003,94447007,94448002,94449005,94450005,94451009,94452002,94453007,94454001,94455000,94456004,94457008,94458003,94459006,94460001,94461002,94462009,94463004,94464005,94465006,94466007,94467003,94468008,94469000,94470004,94471000,94472007,94473002,94474008,94475009,94476005,94477001,94478006,94479003,94480000,94481001,94482008,94483003,94484009,94485005,94486006,94487002,94488007,94489004,94490008,94491007,94492000,94493005,94494004,94495003,94496002,94497006,94498001,94499009,94500000,94501001,94502008,94503003,94504009,94505005,94506006,94507002,94508007,94509004,94510009,94511008,94512001,94513006,94514000,94515004,94516003,94517007,94518002,94519005,94520004,94521000,94522007,94523002,94524008,94525009,94526005,94527001,94528006,94529003,94530008,94531007,94532000,94533005,94534004,94535003,94536002,94537006,94538001,94539009,94540006,94542003,94543008,94544002,94545001,94546000,94547009,94548004,94549007,94550007,94551006,94552004,94553009,94554003,94555002,94556001,94557005,94558000,94559008,94560003,94561004,94562006,94564007,94565008,94566009,94567000,94568005,94569002,94570001,94571002,94572009,94573004,94574005,94575006,94576007,94577003,94578008,94579000,94580002,94581003,94582005,94583000,94584006,94585007,94586008,94587004,94588009,94589001,94590005,94591009,94592002,94593007,94594001,94595000,94596004,94597008,94598003,94599006,94600009,94601008,94602001,94603006,94604000,94605004,94606003,94607007,94608002,94609005,94610000,94611001,94612008,94613003,94614009,94615005,94616006,94617002,94618007,94619004,94620005,94621009,94622002,94623007,94624001,94625000,94626004,94627008,94628003,94629006,94630001,94631002,94632009,94633004,94634005,94635006,94636007,94637003,94638008,94639000,94640003,94641004,94642006,94643001,94644007,94645008,94646009,94647000,94648005,94649002,94650002,94651003,94652005,94653000,94654006,94655007,94656008,94657004,94658009,94659001,94660006,94661005,94662003,94663008,94664002,94665001,94666000,94667009,94668004,94669007,94670008,94671007,94672000,94673005,94674004,94675003,94676002,94677006,94678001,94679009,94680007,94681006,94682004,94683009,94686001,94687005,94688000,94690004,94704006,94707004,94708009,94709001,94710006,94711005,94712003,94714002,94715001,94716000,94718004,94719007,95186006,95187002,95188007,95192000,95193005,95194004,95209008,95210003,95214007,95224004,95225003,95226002,95230004,95231000,95260009,95261008,95263006,95264000,9541000119105,956331000000107,956351000000100,956371000000109,956391000000108,956411000000108,956431000000100,956451000000107,956471000000103,956511000000107,956531000000104,956551000000106,96281000119107,96291000119105,96981000119102,99101000119101,99111000119103,99121000119105,99131000119108',
			'cancer_b',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Chronic Respiratory
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'133971000119108,46847001,233615002,123713005,275376007,721076000,699014000,445427006,314954002,445928005,196049002,413839001,195782000,63841001,26427008,18354001,18121009,13645005,36599006,52571006,427896006,448739000,707553005,69454006,87837008,733171006,733170007,704345008,37180002,102361000119104,240747003,724500003',
			'chronic_respiratory',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Parkinsons
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'32798002,49049000,49049000,723992000,49049000,49049000,722964001,230296006,230292008,32798002,724546003,724823008,49049000,38523005,4223005,265377002,49049000,15782007,230291001,724761004,4223005,723992000,230292008,724762006,766872002,230291001,722558002,715345007,715345007,19972008,230292008,698279003,425390006,766872002,49049000,725146001,49049000,724546003,230294009,722763000,722556003,722763000,715345007,715345007,230296006,722558002,722964001,72820004,72820004,230292008,722435003,702323008,101421000119107,720466001,62239001,38523005,724823008,101421000119107,51100001,101421000119107,265377002,698279003,230293003,724761004,720466001,4223005,716662004,230291001,715345007,715737004,724763001,19972008,724546003,725146001,230294009,766872002,698279003,425390006,722763000,4836003,698279003,72820004,722558002,720466001,425390006,702429008,341551000000108,702323008,62239001,51100001,62239001,438513002',
			'Parkinsons',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Heart Failure
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'84114007,84114007,85232009,56675007,128404006,48447003,417996009,418304008,85232009,42343007,25544003,84114007,314206003,364006,10091002,443254009,443343001,85232009,441481004,42343007,128404006,10633002,120871000119108,120861000119102,56675007,120851000119104,364006,120881000119106,441530006,120861000119102,120901000119108,120891000119109,359617009,120851000119104,120891000119109,120881000119106,48447003,717840005,88805009,67441000119101,67431000119105,111283005,417996009,10335000,418304008,82523003,314206003,424404003,42343007,609389009,25544003,10091002,698594003,46113002,92506005,443254009,443253003,233924009,60856006,443344007,96311000119109,443343001,74960003,120861000119102,120871000119108,364006,441481004,10633002,698296002,120851000119104,80479009,120881000119106,120901000119108,441530006,359617009,120891000119109,83291003,67441000119101,67431000119105,446221000,111283005,5375005,717840005,88805009,10335000,66989003,703272007,83291003',
			'Heart_failure',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Arthritis
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'417180005,417373000,250125001,307500008,16003671000119101,91944005,309661000119108,1771000119109,372939007,70736000,1074911000119106,416209007,699207005,429459001,1074881000119106,699462004,439656005,201728006,201826000,310061000119109,306611000119102,239850004,239851000,239826001,239840000,239841001,239835008,16003591000119104,239789002,239790006,42545001,399112009,396234004,202457009,202461003,202463000,443798008,448394006,448589005,202031002,69896004,77888002,35908007,306811000119101,19192002,1679003,1074681000119107,95408003,11939005,371081002,371082009,1074661000119103',
			'Arthritis',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Stroke
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'16024111000119109,111297002,292661000119105,16023991000119104,275434003,233983001,25133001,16371781000119100,230691006,230713003,30400005,14309005,413102000,292681000119101,16024031000119100,39925003,116288000,195217004,195216008,195212005,716051003,724429004,16024271000119107,281240008,422504002,16026951000119102,723082006,16023911000119108,9901000119100,16024151000119105,292691000119103,16026991000119107,1078001000000105,106016005,292671000119104,371040005,371041009,57981008',
			'Stroke',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Dementia
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	call F50_join_to_observation
		(
			'101421000119107,10349009,10532003,105421000119105,106021000119105,1089501000000102,1089521000000106,1089531000000108,111480006,12348006,130121000119104,13092008,135811000119107,14070001,141991000119109,142001000119106,142011000119109,15662003,1581000119101,1591000119103,16219201000119101,16276361000119109,191449005,191451009,191452002,191454001,191455000,191457008,191458003,191459006,191461002,191463004,191464005,191465006,191466007,191493005,191519005,192818008,20484008,21921000119103,22381000119105,230265002,230266001,230267005,230268000,230269008,230270009,230271008,230272001,230273006,230274000,230280008,230281007,230282000,230283005,230284004,230285003,230286002,230287006,230288001,230289009,2421000119107,25772007,26852004,26929004,278855005,278857002,279982005,281004,288631000119104,304603007,31081000119101,312991009,32875003,371024007,371026009,416780008,416975007,419261000000107,420614009,421023003,421529006,425390006,429458009,429998004,442344002,45864009,4817008,51928006,52448006,54502004,55009008,56267009,59651006,62239001,6475002,65096006,66108005,67155006,698624003,698625002,698626001,698687007,698725008,698726009,698781002,698948009,698949001,698954005,698955006,70936005,713060000,713488003,713844000,715737004,722600006,722977005,722978000,722979008,722980006,723123001,723390000,724776007,724777003,724992007,725898002,733184002,733185001,733190003,733191004,733192006,733193001,733194007,762350007,762351006,762707000,792004,79341000119107,80098002,82361000119107,82371000119101,82381000119103,82959004,83157008,90099008,9345005,97751000119108',
			'Dementia',
			'F50_bartsfrailty_observations',
			'cohort',
			'F50_bartsfrailty_all_obs'
		);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Delirium Admissions
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	drop table if exists F50_bartsfrailty_observations_temp;
	create temporary table F50_bartsfrailty_observations_temp as
	SELECT a.*,
		b.delirium_admission_earliest
		FROM F50_bartsfrailty_observations a
		LEFT JOIN (
					select patient_id
						, 	min(clinical_effective_date) as delirium_admission_earliest
					from F50_bartsfrailty_all_obs
					where organization_id in (294564)
					-- assumes that ICD10 codings indicate that Delirium was at least one of the reasons for admission
					and original_code in ('ICD10_F05','ICD10_F05.0','ICD10_F05.1','ICD10_F05.8','ICD10_F05.9')
					group by patient_id
				) b ON a.patient_id = b.patient_id;

	drop table if exists F50_bartsfrailty_observations;
	create table F50_bartsfrailty_observations as
		SELECT * from F50_bartsfrailty_observations_temp;
	alter table F50_bartsfrailty_observations add index (patient_id);

	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	-- CODESET: Carehome admissions
	-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

	drop table if exists F50_bartsfrailty_observations_temp;
	create temporary table F50_bartsfrailty_observations_temp as
	SELECT a.*,
		b.carehome_admission_earliest
		FROM F50_bartsfrailty_observations a
		LEFT JOIN (
					select patient_id
						, 	min(clinical_effective_date) as carehome_admission_earliest
					from F50_bartsfrailty_all_obs
					where cast(original_code as binary) in ('13F6.','13F61','13F72','13FK.','13FT.','13FX.') -- cast to avoid picking up case insensitive matches
					group by patient_id
				) b ON a.patient_id = b.patient_id;

	drop table if exists F50_bartsfrailty_observations;
	create table F50_bartsfrailty_observations as
		SELECT * from F50_bartsfrailty_observations_temp;
	alter table F50_bartsfrailty_observations add index (patient_id);

    -- drop temp tables
    drop table if exists F50_bartsfrailty_observations_temp;
    drop table if exists obs_out;
    drop table if exists batch;
    drop table if exists F50_obs_out_tmp;
    drop table if exists latest_observations;
    drop table if exists cohort;

END;
// DELIMITER ;
